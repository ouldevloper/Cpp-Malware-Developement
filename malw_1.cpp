#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>

typedef void * var;
int main(){
    var exec_mem;
    BOOL rv;
    HANDLE th;
    DWORD oldprotect = 0;

    unsigned char payload[]={
        0x90,0x90,0xcc,0xc3
    };
    short int len = 4;
    exec_mem =  VirtualAlloc(0,len,MEM_COMMIT|MEM_RESERVE,PAGE_READWRITE);
    RtlMoveMemory(exec_mem,payload,len);
    rv = VirtualProtect(exec_mem,len,PAGE_EXECUTE_READ,&oldprotect);
    printf("Hit me");
    getchar();
    if(rv!=0){
        th = CreateThread(0,0,(LPTHREAD_START_ROUTINE)exec_mem,0,0,0);
        WaitForSingleObject(th,-1);
    }
    return 0;
}